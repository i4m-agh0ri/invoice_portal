{% extends 'base.html' %}
{% block title %}Invoice Portal{% endblock %}
{% block content %}
  <div class="split">
    <div class="card">
      <h2>Your Data</h2>
      <p class="muted">Your invoices live in your browser (YAML). Import/export below.</p>
      <div id="data-panel" class="grid">
        <label>YAML Data
          <textarea id="data-yaml" style="height:220px"></textarea>
        </label>
        <div class="row">
          <button class="btn" id="btn-load">Load from YAML</button>
          <button class="btn" id="btn-save">Save to LocalStorage</button>
          <button class="btn" id="btn-export">Export from LocalStorage</button>
          <button class="btn" id="btn-sample">Load Sample</button>
        </div>
      </div>
    </div>
    <div class="card">
      <h2>Invoices</h2>
      <div id="shell-main" hx-post="/invoices" hx-trigger="load" hx-target="#shell-main"></div>
    </div>
  </div>
  <script>
    const sampleYAML = `client:
  name: Acme Corp
  email: acme@example.com
  address_line1: 123 Market St
  address_line2:
  city: San Francisco
  state: CA
  postal_code: 94105
  country: US
  tax_id: US-123456789
invoices:
  - id: 1
    number: INV-1001
    currency: USD
    issue_date: 2025-01-10
    due_date: 2025-02-10
    status: open
    tax_rate: 0.07
    notes: Thanks!
  - id: 2
    number: INV-1000
    currency: USD
    issue_date: 2024-12-01
    due_date: 2024-12-31
    status: paid
    tax_rate: 0.07
    notes: Paid in full
items:
  - invoice_id: 1
    description: Design
    quantity: 10
    unit_price: 80
  - invoice_id: 1
    description: Development
    quantity: 20
    unit_price: 120
  - invoice_id: 2
    description: Retainer
    quantity: 1
    unit_price: 5000
payments:
  - invoice_id: 2
    amount: 5350
    currency: USD
    method: stub
    reference: demo
`;
    function $(id){ return document.getElementById(id); }
    function syncText(){ $('data-yaml').value = getClientDataYAML() || jsyaml.dump(getClientData(), {lineWidth: 100}); }
    document.addEventListener('DOMContentLoaded', syncText);
    $('btn-export').addEventListener('click', function(){ syncText(); });
    $('btn-save').addEventListener('click', function(){ setClientDataYAML($('data-yaml').value); alert('Saved to LocalStorage'); });
    $('btn-load').addEventListener('click', function(){ setClientDataYAML($('data-yaml').value); htmx.ajax('POST','/invoices',{target:'#shell-main'}); });
    $('btn-sample').addEventListener('click', function(){ $('data-yaml').value = sampleYAML; });
  </script>
{% endblock %}

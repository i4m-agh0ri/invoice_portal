<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Invoice {{ invoice['number'] }}</title>
  <style>
    :root { --ink: #111827; --muted: #6b7280; --border:#e5e7eb; }
    * { box-sizing: border-box; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, sans-serif; color: var(--ink); margin: 40px; }
    .header { display: grid; grid-template-columns: 1fr auto; gap: 16px; align-items: start; }
    h1 { margin: 0; font-size: 28px; }
    .meta { text-align: right; font-size: 14px; color: var(--muted); }
    .billto { margin-top: 16px; }
    .billto h3 { margin: 0 0 8px 0; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; margin-top: 16px; }
    th, td { border-bottom: 1px solid var(--border); padding: 10px 8px; font-size: 14px; }
    th { text-align: left; color: var(--muted); }
    th.right, td.right { text-align: right; }
    .amount { width: 20%; }
    .qty { width: 10%; }
    .unit { width: 20%; }
    .desc { width: 50%; }
    .totals { margin-top: 16px; width: 40%; margin-left: auto; }
    .totals td { border: none; padding: 6px 0; }
    .totals td:first-child { color: var(--muted); }
    .totals tr:last-child td { font-weight: 700; border-top: 1px solid var(--border); padding-top: 10px; }
    .actions { margin-top: 16px; }
    .btn { display: inline-block; padding: 8px 10px; border: 1px solid #d1d5db; background: #f9fafb; color: #111827; border-radius: 6px; text-decoration: none; font-size: 14px; }
    @media print {
      .actions { display: none; }
      body { margin: 0.5in; }
    }
  </style>
  </head>
<body>
  <div class="header">
    <h1>Invoice {{ invoice['number'] }}</h1>
    <div class="meta">
      <div>Issue: {{ invoice['issue_date'] }}</div>
      <div>Due: {{ invoice['due_date'] }}</div>
      <div>Status: {{ invoice['status']|capitalize }}</div>
    </div>
  </div>
  <div class="billto">
    <h3>Bill To</h3>
    <div>
      {{ client['name'] }}<br>
      {{ client['address_line1'] }} {{ client['address_line2'] }}<br>
      {{ client['city'] }}, {{ client['state'] }} {{ client['postal_code'] }}<br>
      {{ client['country'] }}<br>
      Tax ID: {{ client['tax_id'] }}
    </div>
  </div>
  <table>
    <thead>
      <tr>
        <th class="desc">Description</th>
        <th class="qty right">Qty</th>
        <th class="unit right">Unit Price</th>
        <th class="amount right">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item['description'] }}</td>
        <td class="right">{{ '%.2f'|format(item['quantity']) }}</td>
        <td class="right">{{ invoice['currency'] }} {{ '%.2f'|format(item['unit_price']) }}</td>
        <td class="right">{{ invoice['currency'] }} {{ '%.2f'|format(item['quantity'] * item['unit_price']) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <table class="totals">
    <tr><td>Subtotal</td><td class="right">{{ invoice['currency'] }} {{ '%.2f'|format(totals.subtotal) }}</td></tr>
    <tr><td>Tax ({{ '%.0f'|format(invoice['tax_rate']*100) }}%)</td><td class="right">{{ invoice['currency'] }} {{ '%.2f'|format(totals.tax) }}</td></tr>
    <tr><td>Total</td><td class="right">{{ invoice['currency'] }} {{ '%.2f'|format(totals.total) }}</td></tr>
  </table>
  <div class="actions">
    <a class="btn" href="#" onclick="window.print();return false;">Print / Save as PDF</a>
  </div>

  {% if auto_print %}
  <script>
    // Trigger print automatically when requested
    window.addEventListener('load', function(){
      setTimeout(function(){
        window.print();
      }, 50);
    });
  </script>
  {% endif %}
</body>
</html>

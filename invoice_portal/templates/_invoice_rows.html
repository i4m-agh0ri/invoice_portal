{% for inv in invoices %}
  {% set totals = totals_map[inv['id']|string] %}
  <tr>
    <td><a href="#" hx-post="/invoice/{{ inv['id'] }}" hx-target="#shell-main">{{ inv['number'] }}</a></td>
    <td>{{ inv['issue_date'] }}</td>
    <td>{{ inv['due_date'] }}</td>
    <td><span class="badge {{ inv['status'] }}">{{ inv['status']|capitalize }}</span></td>
    <td>{{ inv['currency'] }} {{ '%.2f'|format(totals.total) }}</td>
    <td>{{ inv['currency'] }} {{ '%.2f'|format(totals.paid) }}</td>
    <td>{{ inv['currency'] }} {{ '%.2f'|format(totals.due) }}</td>
    <td>
      <button class="btn" onclick="openPdf({{ inv['id'] }})">View</button>
      {% if totals.due > 0 and inv['status'] in ['open','overdue'] %}
      <button class="btn" data-pay="{{ inv['id'] }}">Pay</button>
      {% endif %}
    </td>
  </tr>
{% else %}
  <tr><td colspan="8">No invoices.</td></tr>
{% endfor %}

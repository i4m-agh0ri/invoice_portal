{% extends 'base.html' %}
{% block title %}Help • Invoice Portal{% endblock %}
{% block content %}
  <h1>Design Your Invoices (YAML Guide)</h1>
  <p class="muted">No database, no signup — your data lives in your browser. Follow these simple steps and you’ll have a professional invoice PDF in minutes.</p>

  <div class="card">
    <h2>Start Here (2 minutes)</h2>
    <ol>
      <li>Click <a href="/designer">Designer</a>.</li>
      <li>Click <strong>Load Sample</strong> or <button class="btn" id="btn-load-minimal">Load Minimal Template</button>.</li>
      <li>Change your <strong>client</strong> info and one <strong>invoice</strong>.</li>
      <li>Add a few <strong>items</strong> with prices.</li>
      <li>Click <strong>Save to LocalStorage</strong>. Then open <strong>Invoices</strong> or click <strong>Preview PDF</strong> in Designer.</li>
    </ol>
    <p class="muted">Tip: PDF works for paid or unpaid invoices. The <em>Notes</em> field appears in the PDF’s “Additional Notes / Company Stamps” box so companies can stamp/sign.</p>
  </div>

  <div class="card">
    <h2>YAML Basics (60 seconds)</h2>
    <ul>
      <li><strong>Spaces, not tabs</strong>. Indent with 2 spaces.</li>
      <li><strong>Lists use dashes</strong>: <code>-</code></li>
      <li><strong>key: value</strong> pairs. Strings usually don’t need quotes.</li>
      <li><strong>Numbers</strong> are plain: <code>10</code>, <code>99.5</code>. Dates as <code>YYYY-MM-DD</code>.</li>
    </ul>
  </div>

  <div class="card">
    <h2>Minimal Template</h2>
    <p class="muted">This is the smallest useful invoice. One client, one invoice, a couple of items.</p>
    <pre><code id="minimal-yaml">client:
  name: Your Name or Company
  email: you@example.com
  address_line1: 123 Street
  city: City
  state: ST
  postal_code: 12345
  country: US
invoices:
  - id: 1
    number: INV-0001
    currency: USD
    issue_date: 2025-01-01
    due_date: 2025-01-31
    status: open      # open|paid|overdue
    tax_rate: 0.00    # 0 for no tax, or 0.07 for 7%
    notes: Thank you for your business!
items:
  - invoice_id: 1
    description: Design work
    quantity: 5
    unit_price: 50
  - invoice_id: 1
    description: Development
    quantity: 10
    unit_price: 80
payments: []
    </code></pre>
    <div class="row">
      <button class="btn" id="btn-copy-minimal">Copy</button>
      <button class="btn" id="btn-use-minimal">Use This (save to browser)</button>
      <a class="btn" href="/designer">Open Designer</a>
    </div>
  </div>

  <div class="card">
    <h2>Full Example</h2>
    <p>Prefer a richer template with two invoices, items, and a payment? Use the full sample below.</p>
    <p>
      <a class="btn" href="{{ url_for('static', filename='samples/invoices.yaml') }}" download>Download Full Sample</a>
      <button class="btn" id="btn-load-sample-here">Load Full Sample Into Browser</button>
    </p>
    <p class="muted">Loading will overwrite your current local data. Export first from the Home page if you want a backup.</p>
  </div>

  <div class="card">
    <h2>Field Cheatsheet</h2>
    <ul>
      <li><strong>client</strong>: your billing info (name, email, address, tax_id).</li>
      <li><strong>invoices</strong>: list. Each invoice needs <strong>id</strong> (number), <strong>number</strong> (like INV-0001), <strong>currency</strong> (USD/EUR…), <strong>issue_date</strong>, <strong>due_date</strong>, <strong>status</strong> (open/paid/overdue), <strong>tax_rate</strong> (0.07 = 7%), optional <strong>notes</strong>.</li>
      <li><strong>items</strong>: list. Each item has <strong>invoice_id</strong> (links to an invoice), <strong>description</strong>, <strong>quantity</strong>, <strong>unit_price</strong>.</li>
      <li><strong>payments</strong>: list (optional). Each payment has <strong>invoice_id</strong>, <strong>amount</strong>, <strong>currency</strong>, and optional method/reference.</li>
    </ul>
  </div>

  <div class="card">
    <h2>Common Mistakes (and fixes)</h2>
    <ul>
      <li>Using tabs → use spaces instead.</li>
      <li>Forgetting dashes in lists → each item starts with <code>-</code>.</li>
      <li>Wrong indent → child lines are indented 2 spaces under their parent.</li>
      <li>Items don’t show up → make sure <code>items[].invoice_id</code> matches an <code>invoices[].id</code>.</li>
      <li>No totals → check that <code>quantity</code> and <code>unit_price</code> are numbers, not quoted strings.</li>
    </ul>
  </div>

  <div class="card">
    <h2>FAQ</h2>
    <p><strong>Do I need an account?</strong> No. Everything is saved in your browser (LocalStorage).</p>
    <p><strong>Can I make a PDF if it’s unpaid?</strong> Yes. PDF works for any status.</p>
    <p><strong>Where do my items go?</strong> In the <code>items</code> list. Each one links to an invoice using <code>invoice_id</code>.</p>
    <p><strong>How do I change currency?</strong> Set <code>currency</code> per invoice (USD, EUR, GBP, JPY…).</p>
    <p><strong>How do taxes work?</strong> Use a decimal rate (e.g., 0.10 = 10%). Totals are calculated for you.</p>
  </div>

  <script>
    // Minimal YAML text (kept here so you can copy/use instantly)
    const minimalYAML = document.getElementById('minimal-yaml').innerText;

    async function loadFullSample() {
      const res = await fetch('{{ url_for('static', filename='samples/invoices.yaml') }}', {cache:'no-store'});
      return await res.text();
    }

    function saveToBrowser(y){ setClientDataYAML(y || ''); }

    document.getElementById('btn-load-sample-here').addEventListener('click', async function(){
      try {
        const y = await loadFullSample();
        saveToBrowser(y);
        alert('Loaded full sample into your browser. Go to Invoices to see it.');
      } catch (e) { alert('Failed to load sample YAML'); }
    });

    document.getElementById('btn-use-minimal').addEventListener('click', function(){
      saveToBrowser(minimalYAML);
      alert('Saved minimal template to your browser. Open Invoices or Designer to edit.');
    });

    document.getElementById('btn-copy-minimal').addEventListener('click', async function(){
      try { await navigator.clipboard.writeText(minimalYAML); alert('Copied!'); }
      catch { alert('Copy failed. Select and copy the text manually.'); }
    });

    document.getElementById('btn-load-minimal').addEventListener('click', function(){
      saveToBrowser(minimalYAML);
      window.location.href = '/designer';
    });
  </script>
{% endblock %}
